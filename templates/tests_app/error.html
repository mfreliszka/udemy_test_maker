{% extends 'base.html' %}
{% load static %}

{% block title %}Error - Udemy Test Maker{% endblock %}

{% block page_title %}
<i class="fas fa-exclamation-triangle mr-3 text-error"></i>Oops! Something went wrong
{% endblock %}

{% block page_description %}
We're sorry, but an error occurred while processing your request
{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <!-- Error Card -->
    <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-body text-center py-12">
            <div class="text-6xl text-error mb-4">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            
            <h2 class="text-2xl font-bold text-base-content mb-4">
                {% if error_code %}Error {{ error_code }}{% else %}Something went wrong{% endif %}
            </h2>
            
            <p class="text-base-content/70 mb-6">
                {% if error_message %}
                    {{ error_message }}
                {% else %}
                    We encountered an unexpected error while processing your request. Please try again.
                {% endif %}
            </p>
            
            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button onclick="history.back()" class="btn btn-ghost">
                    <i class="fas fa-arrow-left mr-2"></i>Go Back
                </button>
                <a href="{% url 'tests_app:dashboard' %}" class="btn btn-primary">
                    <i class="fas fa-home mr-2"></i>Return to Dashboard
                </a>
                <button onclick="location.reload()" class="btn btn-secondary">
                    <i class="fas fa-refresh mr-2"></i>Try Again
                </button>
            </div>
        </div>
    </div>

    <!-- Helpful Information -->
    <div class="card bg-blue-50 border border-blue-200">
        <div class="card-body">
            <h3 class="card-title text-blue-800 mb-4">
                <i class="fas fa-info-circle mr-2"></i>What you can do:
            </h3>
            
            <div class="space-y-3 text-blue-700">
                <div class="flex items-start">
                    <i class="fas fa-check mr-3 mt-1 text-blue-600"></i>
                    <span>Check if the page URL is correct</span>
                </div>
                <div class="flex items-start">
                    <i class="fas fa-check mr-3 mt-1 text-blue-600"></i>
                    <span>Refresh the page and try again</span>
                </div>
                <div class="flex items-start">
                    <i class="fas fa-check mr-3 mt-1 text-blue-600"></i>
                    <span>Go back to the previous page</span>
                </div>
                <div class="flex items-start">
                    <i class="fas fa-check mr-3 mt-1 text-blue-600"></i>
                    <span>Return to the dashboard and start over</span>
                </div>
            </div>
            
            {% if request.user.is_staff %}
            <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded">
                <h4 class="font-medium text-yellow-800 mb-2">
                    <i class="fas fa-cog mr-2"></i>Admin Information:
                </h4>
                <div class="text-sm text-yellow-700">
                    <p><strong>URL:</strong> {{ request.get_full_path }}</p>
                    <p><strong>Method:</strong> {{ request.method }}</p>
                    <p><strong>User:</strong> {{ request.user }}</p>
                    {% if exception %}
                    <p><strong>Exception:</strong> {{ exception }}</p>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Contact Support (Optional) -->
    <div class="text-center mt-6">
        <p class="text-sm text-base-content/60">
            If the problem persists, you can check the 
            <a href="{% url 'admin:index' %}" class="link link-primary" target="_blank">admin panel</a>
            or review the application logs.
        </p>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Auto-retry functionality
let retryCount = 0;
const maxRetries = 3;

function autoRetry() {
    if (retryCount < maxRetries) {
        retryCount++;
        showToast(`Retrying... (${retryCount}/${maxRetries})`, 'info');
        
        setTimeout(() => {
            location.reload();
        }, 2000);
    } else {
        showToast('Maximum retries reached. Please try manual refresh.', 'warning');
    }
}

// Show auto-retry option for certain errors
document.addEventListener('DOMContentLoaded', function() {
    const errorCode = '{% if error_code %}{{ error_code }}{% endif %}';
    
    // Auto-retry for server errors (5xx)
    if (errorCode && errorCode.startsWith('5')) {
        setTimeout(() => {
            const retryPrompt = confirm('Would you like to automatically retry loading this page?');
            if (retryPrompt) {
                autoRetry();
            }
        }, 3000);
    }
});
</script>
{% endblock %}