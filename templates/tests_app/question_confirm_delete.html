{% extends 'base.html' %}
{% load static %}

{% block title %}Delete Question - Udemy Test Maker{% endblock %}

{% block breadcrumb_items %}
<li><a href="{% url 'tests_app:question_list' %}">Questions</a></li>
<li><a href="{% url 'tests_app:question_detail' question.pk %}">{{ question.question_text|truncatechars:30 }}</a></li>
<li>Delete</li>
{% endblock %}

{% block page_title %}
<i class="fas fa-trash mr-3 text-error"></i>Delete Question
{% endblock %}

{% block page_description %}
Confirm deletion of this practice question
{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <!-- Warning Card -->
    <div class="card bg-error/10 border border-error/20 shadow-xl mb-6">
        <div class="card-body">
            <div class="flex items-center mb-4">
                <div class="text-error text-4xl mr-4">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div>
                    <h2 class="card-title text-error text-xl">Warning: This action cannot be undone</h2>
                    <p class="text-error/80">You are about to permanently delete this question and all its associated answers.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Question Preview -->
    <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-body">
            <h3 class="card-title text-lg mb-4">
                <i class="fas fa-question-circle mr-2 text-blue-500"></i>Question to be deleted:
            </h3>
            
            <!-- Question Metadata -->
            <div class="flex flex-wrap gap-2 mb-4">
                <div class="badge badge-primary">Test {{ question.test_number }}</div>
                <div class="badge badge-outline">{{ question.exam.display_name }}</div>
                <div class="badge badge-{% if question.question_type == 'multiple_select' %}info{% else %}success{% endif %}">
                    {% if question.question_type == 'multiple_select' %}Multiple Select{% else %}Single Choice{% endif %}
                </div>
                <div class="badge badge-ghost">{{ question.get_difficulty_display }}</div>
            </div>
            
            <!-- Question Text -->
            <div class="bg-base-200 p-4 rounded-lg mb-4">
                <p class="text-base leading-relaxed">{{ question.question_text }}</p>
            </div>
            
            <!-- Domain Information -->
            <div class="text-sm text-base-content/70 mb-4">
                <i class="fas fa-sitemap mr-1"></i>
                <strong>Domain:</strong> {{ question.domain.name }}
            </div>
            
            <!-- Answer Summary -->
            <div class="border-t pt-4">
                <h4 class="font-medium mb-2">
                    <i class="fas fa-list-ul mr-1"></i>
                    Answers ({{ question.total_answers }} options)
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                    {% for answer in question.answers.all %}
                    <div class="flex items-center">
                        {% if answer.is_correct %}
                            <i class="fas fa-check-circle text-success mr-2"></i>
                        {% else %}
                            <i class="fas fa-times-circle text-error mr-2"></i>
                        {% endif %}
                        <span class="{% if answer.is_correct %}text-success{% endif %}">
                            {{ answer.answer_text|truncatechars:50 }}
                        </span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Additional Info -->
            <div class="mt-4 p-3 bg-orange-50 border-l-4 border-orange-400 rounded">
                <div class="text-sm text-orange-800">
                    <i class="fas fa-info-circle mr-1"></i>
                    <strong>Impact:</strong> This will permanently delete:
                    <ul class="list-disc list-inside mt-1 ml-4">
                        <li>The question text and metadata</li>
                        <li>All {{ question.total_answers }} answer options</li>
                        <li>All explanations and comments</li>
                        <li>Question statistics and history</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Form -->
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <h3 class="card-title text-error mb-4">
                <i class="fas fa-clipboard-check mr-2"></i>Confirm Deletion
            </h3>
            
            <form method="post" id="deleteForm">
                {% csrf_token %}
                
                <!-- Confirmation Checkbox -->
                <div class="form-control mb-6">
                    <label class="label cursor-pointer justify-start">
                        <input type="checkbox" class="checkbox checkbox-error mr-3" id="confirmDelete" required>
                        <span class="label-text">
                            I understand that this action is permanent and cannot be undone
                        </span>
                    </label>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-3 justify-end">
                    <a href="{% url 'tests_app:question_detail' question.pk %}" class="btn btn-ghost order-1 sm:order-1">
                        <i class="fas fa-times mr-2"></i>Cancel
                    </a>
                    <a href="{% url 'tests_app:question_list' %}" class="btn btn-secondary order-2 sm:order-2">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Questions
                    </a>
                    <button type="submit" class="btn btn-error order-3 sm:order-3" id="deleteButton" disabled>
                        <i class="fas fa-trash mr-2"></i>Delete Question
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Alternative Actions -->
    <div class="card bg-blue-50 border border-blue-200 mt-6">
        <div class="card-body">
            <h3 class="card-title text-blue-800 text-lg mb-3">
                <i class="fas fa-lightbulb mr-2"></i>Consider these alternatives:
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="text-center">
                    <div class="text-blue-600 text-2xl mb-2">
                        <i class="fas fa-edit"></i>
                    </div>
                    <h4 class="font-medium text-blue-800 mb-2">Edit Instead</h4>
                    <p class="text-blue-600 text-sm mb-3">Modify the question to fix any issues</p>
                    <a href="{% url 'tests_app:question_edit' question.pk %}" class="btn btn-sm btn-primary">
                        <i class="fas fa-edit mr-1"></i>Edit Question
                    </a>
                </div>
                <div class="text-center">
                    <div class="text-blue-600 text-2xl mb-2">
                        <i class="fas fa-eye-slash"></i>
                    </div>
                    <h4 class="font-medium text-blue-800 mb-2">Deactivate</h4>
                    <p class="text-blue-600 text-sm mb-3">Hide without permanently deleting</p>
                    <a href="{% url 'tests_app:question_edit' question.pk %}" class="btn btn-sm btn-secondary">
                        <i class="fas fa-eye-slash mr-1"></i>Deactivate
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const confirmCheckbox = document.getElementById('confirmDelete');
    const deleteButton = document.getElementById('deleteButton');
    const deleteForm = document.getElementById('deleteForm');

    // Enable/disable delete button based on checkbox
    confirmCheckbox.addEventListener('change', function() {
        deleteButton.disabled = !this.checked;
        deleteButton.classList.toggle('btn-disabled', !this.checked);
    });

    // Double confirmation on form submit
    deleteForm.addEventListener('submit', function(e) {
        if (!confirmCheckbox.checked) {
            e.preventDefault();
            return false;
        }

        const confirmed = confirm(
            'This is your final chance to cancel.\n\n' +
            'Are you absolutely sure you want to delete this question?\n\n' +
            'This action CANNOT be undone.'
        );

        if (!confirmed) {
            e.preventDefault();
            return false;
        }

        // Show loading state
        deleteButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Deleting...';
        deleteButton.disabled = true;
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Escape key to cancel
        if (e.key === 'Escape') {
            window.location.href = '{% url "tests_app:question_detail" question.pk %}';
        }
        // Ctrl+Enter to submit (only if checkbox is checked)
        else if (e.key === 'Enter' && e.ctrlKey && confirmCheckbox.checked) {
            deleteForm.submit();
        }
    });
});
</script>
{% endblock %}